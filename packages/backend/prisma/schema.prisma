generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "windows"]
   
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model boards {
  id            Int           @id @default(autoincrement())
  orgId        Int @map("org_id")
  name          String        @db.VarChar(255)
  createdAt    DateTime?     @map("created_at")@ default(now()) @db.Timestamp(6)
  organizations organizations @relation(fields: [orgId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  columns       columns[]
}

model cards {
  id          Int       @id @default(autoincrement())
  documentId Int @map("document_id")
  columnId   Int @map("column_id")
  position    Int
  createdAt  DateTime? @map("created_at")@ default(now()) @db.Timestamp(6)
  columns     columns   @relation(fields: [columnId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  documents   documents @relation(fields: [documentId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model columns {
  id         Int       @id @default(autoincrement())
  boardId   Int @map("board_id")
  name       String    @db.VarChar(100)
  position   Int
  createdAt DateTime? @map("created_at")@ default(now()) @db.Timestamp(6)
  cards      cards[]
  boards     boards    @relation(fields: [boardId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model comments {
  id          Int       @id @default(autoincrement())
  documentId Int @map("document_id")
  userId     Int @map("user_id")
  content     String
  createdAt  DateTime? @map("created_at")@ default(now()) @db.Timestamp(6)
  documents   documents @relation(fields: [documentId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users       users     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model document_versions {
  id             Int       @id @default(autoincrement())
  documentId    Int @map("document_id")
  versionNumber Int @map("version_number")
  filePath      String    @map("file_path") @db.VarChar(500)
  createdAt     DateTime? @map("created_at")@ default(now()) @db.Timestamp(6)
  documents      documents @relation(fields: [documentId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

enum DocumentStatus {
  received
  in_review
  approved
  signed
  on_hold
}

model documents {
  id                Int                 @id @default(autoincrement())
  orgId            Int @map("org_id")
  title             String              @db.VarChar(255)
  originalName      String              @map("original_name") @db.VarChar(255) 
  filePath         String              @map("file_path") @db.VarChar(500)
  contentHash      String              @map("content_hash") @db.VarChar(64) 
  status           DocumentStatus      @default(received)
  uploadedBy       Int?                @map("uploaded_by")
  createdAt        DateTime?           @map("created_at") @default(now()) @db.Timestamp(6)
  updatedAt        DateTime?           @map("updated_at") @updatedAt @db.Timestamp(6)
  cards            cards[]
  comments         comments[]
  document_versions document_versions[]
  organizations    organizations       @relation(fields: [orgId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users            users?              @relation(fields: [uploadedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  shares           shares[]

 @@unique([orgId, contentHash, uploadedBy], name: "documents_org_id_content_hash_user_id_key")
}
model organizations {
  id         Int         @id @default(autoincrement())
  name       String      @db.VarChar(255)
  createdAt DateTime?   @map("created_at")@default(now()) @db.Timestamp(6)
  boards     boards[]
  documents  documents[]
  users      users[]
}

model shares {
  id          Int       @id @default(autoincrement())
  documentId Int @map("document_id")
  sharedWith Int @map("shared_with")
  permission  String    @default("view") @db.VarChar(50)
  createdAt  DateTime? @map("created_at")@default(now()) @db.Timestamp(6)
  documents   documents @relation(fields: [documentId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users       users     @relation(fields: [sharedWith], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model signatures {
  id         Int       @id @default(autoincrement())
  userId    Int  @map("user_id")
  filePath  String    @map("file_path") @db.VarChar(500)
  createdAt DateTime? @map("created_at")@default(now()) @db.Timestamp(6)
  users      users     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model users {
  id            Int           @id @default(autoincrement())
  orgId        Int @map("org_id")
  email         String        @unique @db.VarChar(255)
  fullName     String?       @db.VarChar(255)
  createdAt    DateTime?     @map("created_at")@default(now()) @db.Timestamp(6)
  comments      comments[]
  documents     documents[]
  shares        shares[]
  signatures    signatures[]
  organizations organizations @relation(fields: [orgId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}
